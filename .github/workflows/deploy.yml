name: Deploy to IIS

on:
  push:
    branches:
      - main

jobs:
  deploy:
    runs-on: self-hosted

    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      - name: Deploy to wwwroot
        run: |
          $target = "C:\inetpub\wwwroot"

          if (Test-Path $target) {
            Get-ChildItem -Path $target -Recurse -Force | Remove-Item -Force -Recurse
          } else {
            New-Item -ItemType Directory -Path $target | Out-Null
          }

          Copy-Item -Path "$env:GITHUB_WORKSPACE\*" -Destination $target -Recurse -Force
